<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#10b981" />
  <title>ì™„ë£Œí•œ ë‹¨ì–´ - WordSwipe</title>
  
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --primary: #6366f1;
      --secondary: #8b5cf6;
      --success: #10b981;
      --bg-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
    }

    html, body { height: 100%; overflow-x: hidden; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-gradient);
      position: relative;
      -webkit-tap-highlight-color: transparent;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: 
        radial-gradient(circle at 25% 35%, rgba(255,255,255,0.12) 0%, transparent 50%),
        radial-gradient(circle at 75% 65%, rgba(255,255,255,0.08) 0%, transparent 50%);
      pointer-events: none;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
      padding: max(20px, env(safe-area-inset-top)) 16px max(80px, env(safe-area-inset-bottom)) 16px;
    }

    header {
      margin-bottom: 24px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      color: white;
      text-decoration: none;
      border-radius: 14px;
      font-weight: 700;
      font-size: 14px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.2s ease;
      margin-bottom: 16px;
    }

    .back-btn:active { transform: scale(0.96); }

    h1 {
      font-size: 32px;
      font-weight: 900;
      color: white;
      text-shadow: 0 2px 12px rgba(0,0,0,0.2);
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 15px;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
    }

    .stats-overview {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .stat-box {
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 900;
      color: white;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 12px;
      color: rgba(255,255,255,0.85);
      font-weight: 700;
    }

    .filter-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      overflow-x: auto;
      padding-bottom: 4px;
    }

    .filter-tab {
      padding: 10px 18px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      color: white;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s ease;
    }

    .filter-tab.active {
      background: white;
      color: var(--success);
      border-color: white;
    }

    .filter-tab:active {
      transform: scale(0.96);
    }

    .word-grid {
      display: grid;
      gap: 12px;
      margin-bottom: 20px;
    }

    .word-card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-radius: 18px;
      padding: 18px 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 
        0 4px 16px rgba(0,0,0,0.08),
        inset 0 1px 0 rgba(255,255,255,0.9);
    }

    .word-card:active {
      transform: scale(0.97);
    }

    .word-card.flipped .word-front {
      display: none;
    }

    .word-card.flipped .word-back {
      display: block;
    }

    .word-front {
      display: block;
    }

    .word-back {
      display: none;
    }

    .word-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .word-term {
      font-size: 20px;
      font-weight: 900;
      color: #1e293b;
      letter-spacing: -0.3px;
    }

    .word-badge {
      font-size: 11px;
      font-weight: 800;
      color: var(--success);
      background: rgba(16, 185, 129, 0.1);
      padding: 4px 10px;
      border-radius: 8px;
    }

    .word-meaning {
      font-size: 16px;
      color: var(--success);
      font-weight: 700;
      margin-bottom: 10px;
    }

    .word-def {
      font-size: 13px;
      color: #64748b;
      font-style: italic;
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .word-example {
      font-size: 14px;
      color: #475569;
      line-height: 1.4;
      padding: 10px;
      background: rgba(16, 185, 129, 0.05);
      border-left: 3px solid var(--success);
      border-radius: 8px;
    }

    .word-meta {
      display: flex;
      gap: 12px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed rgba(16, 185, 129, 0.2);
    }

    .meta-item {
      font-size: 11px;
      color: #64748b;
      font-weight: 700;
    }

    .meta-item strong {
      color: #1e293b;
    }

    .restudy-btn {
      margin-top: 12px;
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
      transition: all 0.2s ease;
    }

    .restudy-btn:active {
      transform: scale(0.96);
    }

    .empty-state {
      text-align: center;
      padding: 80px 30px;
      color: white;
    }

    .empty-icon {
      font-size: 80px;
      margin-bottom: 20px;
      opacity: 0.8;
    }

    .empty-title {
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 12px;
    }

    .empty-text {
      font-size: 15px;
      opacity: 0.9;
      line-height: 1.5;
      margin-bottom: 24px;
    }

    .empty-btn {
      display: inline-block;
      background: white;
      color: var(--success);
      padding: 12px 24px;
      border-radius: 999px;
      text-decoration: none;
      font-weight: 800;
      font-size: 15px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      transition: all 0.2s ease;
    }

    .empty-btn:active {
      transform: scale(0.96);
    }

    .loading {
      position: fixed;
      inset: 0;
      background: var(--bg-gradient);
      display: grid;
      place-items: center;
      z-index: 999;
      color: white;
    }

    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,255,255,0.2);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">
    <div>
      <div class="loading-spinner"></div>
      <p style="margin-top:16px; font-size:16px; font-weight:700;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
  </div>

  <div class="container">
    <header>
      <a href="index.html" class="back-btn">â† ëŒì•„ê°€ê¸°</a>
      <h1>âœ… ì™„ë£Œí•œ ë‹¨ì–´</h1>
      <p class="subtitle">í´ë¦­í•´ì„œ ë³µìŠµí•˜ê¸°</p>
    </header>

    <div class="stats-overview">
      <div class="stat-box">
        <div class="stat-value" id="totalCompleted">0</div>
        <div class="stat-label">ì™„ë£Œ</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="avgAccuracy">0%</div>
        <div class="stat-label">í‰ê·  ì •í™•ë„</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="needReview">0</div>
        <div class="stat-label">ë³µìŠµ í•„ìš”</div>
      </div>
    </div>

    <div class="filter-tabs">
      <button class="filter-tab active" data-filter="all">ì „ì²´</button>
      <button class="filter-tab" data-filter="recent">ìµœê·¼ í•™ìŠµ</button>
      <button class="filter-tab" data-filter="mastered">ì™„ì „ ìˆ™ë‹¬</button>
      <button class="filter-tab" data-filter="review">ë³µìŠµ í•„ìš”</button>
    </div>

    <div class="word-grid" id="wordGrid"></div>
  </div>

  <script>
    let ALL_DATA = [];
    let completedWords = [];
    let currentFilter = 'all';

    async function loadCompletedWords() {
      try {
        const res = await fetch('words.json');
        const json = await res.json();
        
        ALL_DATA = json.days.flatMap(d => d.words);
        
        const studied = JSON.parse(localStorage.getItem('studied') || '{}');
        
        // ì™„ë£Œí•œ ë‹¨ì–´ í•„í„°ë§
        completedWords = ALL_DATA.filter(item => studied[item.w]);
        
        if (completedWords.length === 0) {
          showEmpty();
        } else {
          updateStats();
          renderWords(completedWords);
        }
        
      } catch (e) {
        alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        console.error(e);
      } finally {
        document.getElementById('loading').style.display = 'none';
      }
    }

    function updateStats() {
      const studied = JSON.parse(localStorage.getItem('studied') || '{}');
      
      document.getElementById('totalCompleted').textContent = completedWords.length;
      
      // í‰ê·  ì •í™•ë„ ê³„ì‚° (correctCount ê¸°ë°˜)
      const totalCorrect = completedWords.reduce((sum, item) => {
        return sum + (studied[item.w]?.correctCount || 0);
      }, 0);
      const avgAcc = completedWords.length > 0 
        ? Math.round((totalCorrect / completedWords.length) * 20) // 5íšŒ ë§Œì  ê¸°ì¤€
        : 0;
      document.getElementById('avgAccuracy').textContent = Math.min(100, avgAcc) + '%';
      
      // ë³µìŠµ í•„ìš” ë‹¨ì–´ (ë§ˆì§€ë§‰ í•™ìŠµ 3ì¼ ì´ìƒ ì§€ë‚¨)
      const now = Date.now();
      const needReview = completedWords.filter(item => {
        const lastReview = studied[item.w]?.lastReview || 0;
        const daysPassed = (now - lastReview) / (24 * 60 * 60 * 1000);
        return daysPassed > 3;
      }).length;
      
      document.getElementById('needReview').textContent = needReview;
    }

    function renderWords(words) {
      const wordGrid = document.getElementById('wordGrid');
      wordGrid.innerHTML = '';
      
      const studied = JSON.parse(localStorage.getItem('studied') || '{}');
      
      words.forEach(item => {
        const record = studied[item.w] || {};
        const lastReview = record.lastReview || Date.now();
        const daysSince = Math.floor((Date.now() - lastReview) / (24 * 60 * 60 * 1000));
        const correctCount = record.correctCount || 0;
        
        const card = document.createElement('div');
        card.className = 'word-card';
        card.innerHTML = `
          <div class="word-front">
            <div class="word-header">
              <div class="word-term">${item.w}</div>
              <div class="word-badge">Day ${daysSince}</div>
            </div>
            <div class="word-meaning">${item.m}</div>
            <div class="word-meta">
              <div class="meta-item">ì •ë‹µ <strong>${correctCount}íšŒ</strong></div>
              <div class="meta-item">ê°„ê²© <strong>${record.interval || 1}ì¼</strong></div>
            </div>
          </div>
          
          <div class="word-back">
            <div class="word-header">
              <div class="word-term">${item.w}</div>
              <div class="word-badge">ë’¤ì§‘ê¸°</div>
            </div>
            <div class="word-def">${item.def}</div>
            <div class="word-example">${item.ex.replace('_____', item.w)}</div>
            <div style="font-size:13px; color:#64748b; margin-top:8px;">${item.t}</div>
            <button class="restudy-btn" onclick="restudyWord('${item.w}')">ë‹¤ì‹œ í•™ìŠµí•˜ê¸°</button>
          </div>
        `;
        
        // ì¹´ë“œ ë’¤ì§‘ê¸°
        card.onclick = (e) => {
          if (e.target.classList.contains('restudy-btn')) return;
          card.classList.toggle('flipped');
        };
        
        wordGrid.appendChild(card);
      });
    }

    function restudyWord(word) {
      const studied = JSON.parse(localStorage.getItem('studied') || '{}');
      
      // í•™ìŠµ ê¸°ë¡ ì´ˆê¸°í™”
      if (studied[word]) {
        studied[word].interval = 1;
        studied[word].lastReview = Date.now();
        localStorage.setItem('studied', JSON.stringify(studied));
      }
      
      alert(`"${word}" ë³µìŠµ ëª¨ë“œë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤!`);
      location.reload();
    }

    function showEmpty() {
      document.querySelector('.container').innerHTML = `
        <header>
          <a href="index.html" class="back-btn">â† ëŒì•„ê°€ê¸°</a>
          <h1>âœ… ì™„ë£Œí•œ ë‹¨ì–´</h1>
        </header>
        <div class="empty-state">
          <div class="empty-icon">ğŸ“š</div>
          <div class="empty-title">ì•„ì§ ì™„ë£Œí•œ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</div>
          <div class="empty-text">
            í•™ìŠµì„ ì‹œì‘í•˜ë©´<br/>
            ì™„ë£Œí•œ ë‹¨ì–´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
          </div>
          <a href="index.html" class="empty-btn">í•™ìŠµ ì‹œì‘í•˜ê¸°</a>
        </div>
      `;
    }

    // í•„í„° íƒ­
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('filter-tab')) {
        document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
        e.target.classList.add('active');
        
        currentFilter = e.target.dataset.filter;
        applyFilter();
      }
    });

    function applyFilter() {
      const studied = JSON.parse(localStorage.getItem('studied') || '{}');
      const now = Date.now();
      
      let filtered = [...completedWords];
      
      if (currentFilter === 'recent') {
        // ìµœê·¼ 3ì¼ ì´ë‚´ í•™ìŠµ
        filtered = completedWords.filter(item => {
          const lastReview = studied[item.w]?.lastReview || 0;
          const daysPassed = (now - lastReview) / (24 * 60 * 60 * 1000);
          return daysPassed <= 3;
        });
      } else if (currentFilter === 'mastered') {
        // ì •ë‹µ 5íšŒ ì´ìƒ
        filtered = completedWords.filter(item => {
          return (studied[item.w]?.correctCount || 0) >= 5;
        });
      } else if (currentFilter === 'review') {
        // ë³µìŠµ í•„ìš” (3ì¼ ì´ìƒ ì§€ë‚¨)
        filtered = completedWords.filter(item => {
          const lastReview = studied[item.w]?.lastReview || 0;
          const daysPassed = (now - lastReview) / (24 * 60 * 60 * 1000);
          return daysPassed > 3;
        });
      }
      
      renderWords(filtered);
    }

    loadCompletedWords();
  </script>
</body>
</html>
