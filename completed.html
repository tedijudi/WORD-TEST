<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="theme-color" content="#10b981" />
  <title>ì™„ë£Œí•œ ë‹¨ì–´ - WordSwipe</title>
  <link rel="stylesheet" href="common.css" />
  
  <style>
    .container {
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
      padding: max(20px, env(safe-area-inset-top)) 16px max(100px, env(safe-area-inset-bottom)) 16px;
    }

    header {
      margin-bottom: 24px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 16px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      color: white;
      text-decoration: none;
      border-radius: 14px;
      font-weight: 700;
      font-size: 14px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      transition: all 0.2s ease;
      margin-bottom: 16px;
    }

    .back-btn:active { transform: scale(0.96); }

    h1 {
      font-size: 32px;
      font-weight: 900;
      color: white;
      text-shadow: 0 2px 12px rgba(0,0,0,0.2);
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 15px;
      color: rgba(255,255,255,0.9);
      font-weight: 600;
    }

    .stats-overview {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.12);
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .stat-box {
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 900;
      color: white;
      margin-bottom: 4px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .stat-label {
      font-size: 12px;
      color: rgba(255,255,255,0.85);
      font-weight: 700;
    }

    .word-grid {
      display: grid;
      gap: 12px;
      margin-bottom: 20px;
    }

    .word-card {
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-radius: 18px;
      padding: 18px 16px;
      cursor: pointer;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 
        0 4px 16px rgba(0,0,0,0.08),
        inset 0 1px 0 rgba(255,255,255,0.9);
    }

    .word-card:active {
      transform: scale(0.97);
    }

    .word-card.flipped .word-front {
      display: none;
    }

    .word-card.flipped .word-back {
      display: block;
    }

    .word-front {
      display: block;
    }

    .word-back {
      display: none;
    }

    .word-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .word-term {
      font-size: 22px;
      font-weight: 900;
      color: var(--gray-900);
      letter-spacing: -0.3px;
    }

    .word-badge {
      font-size: 11px;
      font-weight: 800;
      color: var(--success);
      background: rgba(16, 185, 129, 0.1);
      padding: 4px 10px;
      border-radius: 8px;
    }

    .word-meaning {
      font-size: 18px;
      color: var(--success);
      font-weight: 700;
      margin-bottom: 10px;
    }

    .word-def {
      font-size: 14px;
      color: var(--gray-600);
      font-style: italic;
      line-height: 1.4;
      margin-bottom: 10px;
    }

    .word-example {
      font-size: 15px;
      color: var(--gray-700);
      line-height: 1.4;
      padding: 10px;
      background: rgba(16, 185, 129, 0.05);
      border-left: 3px solid var(--success);
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .word-translation {
      font-size: 13px;
      color: var(--gray-500);
      line-height: 1.3;
    }

    .word-meta {
      display: flex;
      gap: 12px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px dashed rgba(16, 185, 129, 0.2);
    }

    .meta-item {
      font-size: 11px;
      color: var(--gray-600);
      font-weight: 700;
    }

    .meta-item strong {
      color: var(--gray-900);
    }

    .restudy-btn {
      margin-top: 12px;
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
      transition: all 0.2s ease;
    }

    .restudy-btn:active {
      transform: scale(0.96);
    }

    .empty-state {
      text-align: center;
      padding: 80px 30px;
      color: white;
    }

    .empty-icon {
      font-size: 80px;
      margin-bottom: 20px;
      opacity: 0.8;
    }

    .empty-title {
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 12px;
    }

    .empty-text {
      font-size: 15px;
      opacity: 0.9;
      line-height: 1.5;
      margin-bottom: 24px;
    }

    .bottom-nav {
      position: fixed;
      bottom: max(16px, env(safe-area-inset-bottom) + 8px);
      left: 50%;
      transform: translateX(-50%);
      z-index: 100;
      display: flex;
      gap: 12px;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(30px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 24px;
      box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      padding: 10px 14px;
      background: transparent;
      border: none;
      border-radius: 16px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.2s;
      min-width: 70px;
    }

    .nav-item:active { transform: scale(0.94); }
    .nav-item.active { background: rgba(255, 255, 255, 0.25); }

    .nav-icon { font-size: 24px; line-height: 1; }
    .nav-label {
      font-size: 11px;
      font-weight: 700;
      color: white;
      white-space: nowrap;
    }
  </style>
</head>
<body style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
  <div class="loading" id="loading">
    <div>
      <div class="loading-spinner"></div>
      <p style="margin-top:16px; font-size:16px; font-weight:700;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
    </div>
  </div>

  <div class="container">
    <header>
      <a href="index.html" class="back-btn">â† ëŒì•„ê°€ê¸°</a>
      <h1>âœ… ì™„ë£Œí•œ ë‹¨ì–´</h1>
      <p class="subtitle">í´ë¦­í•´ì„œ ë³µìŠµí•˜ê¸°</p>
    </header>

    <div class="stats-overview">
      <div class="stat-box">
        <div class="stat-value" id="totalCompleted">0</div>
        <div class="stat-label">ì™„ë£Œ</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="avgCorrect">0</div>
        <div class="stat-label">í‰ê·  ì •ë‹µ</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="needReview">0</div>
        <div class="stat-label">ë³µìŠµ í•„ìš”</div>
      </div>
    </div>

    <div class="word-grid" id="wordGrid"></div>
  </div>

  <nav class="bottom-nav">
    <a href="index.html" class="nav-item">
      <div class="nav-icon">ğŸ“š</div>
      <div class="nav-label">ë‹¨ì–´ì¥</div>
    </a>
    <a href="wordsets.html" class="nav-item">
      <div class="nav-icon">ğŸ“–</div>
      <div class="nav-label">ëª©ë¡</div>
    </a>
    <a href="review.html" class="nav-item">
      <div class="nav-icon">ğŸ”</div>
      <div class="nav-label">ë³µìŠµ</div>
    </a>
    <a href="stats.html" class="nav-item">
      <div class="nav-icon">ğŸ“Š</div>
      <div class="nav-label">í†µê³„</div>
    </a>
  </nav>

  <script type="module">
    import { initFirebase, saveToCloud } from './firebase-config.js';

    let ALL_DATA = [];
    let completedWords = [];

    async function init() {
      try {
        await initFirebase();
        
        const res = await fetch('words.json');
        const json = await res.json();
        ALL_DATA = json.words;
        
        const studied = JSON.parse(localStorage.getItem('studied') || '{}');
        completedWords = ALL_DATA.filter(item => studied[item.w]);
        
        if (completedWords.length === 0) {
          showEmpty();
        } else {
          updateStats();
          renderWords();
        }
      } catch (e) {
        console.error('ì´ˆê¸°í™” ì‹¤íŒ¨:', e);
      } finally {
        document.getElementById('loading').style.display = 'none';
      }
    }

    function updateStats() {
      const studied = JSON.parse(localStorage.getItem('studied') || '{}');
      
      document.getElementById('totalCompleted').textContent = completedWords.length;
      
      const totalCorrect = completedWords.reduce((sum, item) => {
        return sum + (studied[item.w]?.correctCount || 0);
      }, 0);
      const avgCorrect = completedWords.length > 0 
        ? Math.round(totalCorrect / completedWords.length)
        : 0;
      document.getElementById('avgCorrect').textContent = avgCorrect;
      
      const now = Date.now();
      const needReview = completedWords.filter(item => {
        const lastReview = studied[item.w]?.lastReview || 0;
        const daysPassed = (now - lastReview) / (24 * 60 * 60 * 1000);
        return daysPassed > 3;
      }).length;
      
      document.getElementById('needReview').textContent = needReview;
    }

    function renderWords() {
      const wordGrid = document.getElementById('wordGrid');
      wordGrid.innerHTML = '';
      
      const studied = JSON.parse(localStorage.getItem('studied') || '{}');
      
      completedWords.forEach(item => {
        const record = studied[item.w] || {};
        const lastReview = record.lastReview || Date.now();
        const daysSince = Math.floor((Date.now() - lastReview) / (24 * 60 * 60 * 1000));
        const correctCount = record.correctCount || 0;
        
        const card = document.createElement('div');
        card.className = 'word-card';
        card.innerHTML = `
          <div class="word-front">
            <div class="word-header">
              <div class="word-term">${item.w}</div>
              <div class="word-badge">${daysSince}ì¼ ì „</div>
            </div>
            <div class="word-meaning">${item.m}</div>
            <div class="word-meta">
              <div class="meta-item">ì •ë‹µ <strong>${correctCount}íšŒ</strong></div>
            </div>
          </div>
          
          <div class="word-back">
            <div class="word-header">
              <div class="word-term">${item.w}</div>
              <div class="word-badge">ë’¤ì§‘ê¸°</div>
            </div>
            <div class="word-meaning">${item.m}</div>
            <div class="word-def">${item.def}</div>
            <div class="word-example">${item.ex.replace('_____', item.w)}</div>
            <div class="word-translation">${item.t}</div>
            <button class="restudy-btn" data-word="${item.w}">ë‹¤ì‹œ í•™ìŠµí•˜ê¸°</button>
          </div>
        `;
        
        card.onclick = (e) => {
          if (e.target.classList.contains('restudy-btn')) {
            const word = e.target.dataset.word;
            restudyWord(word);
            return;
          }
          card.classList.toggle('flipped');
        };
        
        wordGrid.appendChild(card);
      });
    }

    function restudyWord(word) {
      const studied = JSON.parse(localStorage.getItem('studied') || '{}');
      
      if (studied[word]) {
        studied[word].lastReview = Date.now() - (4 * 24 * 60 * 60 * 1000); // 4ì¼ ì „ìœ¼ë¡œ ì„¤ì •
        localStorage.setItem('studied', JSON.stringify(studied));
        saveToCloud();
      }
      
      alert(`âœ… "${word}"ë¥¼ ë³µìŠµ ëª©ë¡ì— ì¶”ê°€í–ˆìŠµë‹ˆë‹¤!`);
      updateStats();
      renderWords();
    }

    function showEmpty() {
      document.querySelector('.container').innerHTML = `
        <header>
          <a href="index.html" class="back-btn">â† ëŒì•„ê°€ê¸°</a>
          <h1>âœ… ì™„ë£Œí•œ ë‹¨ì–´</h1>
        </header>
        <div class="empty-state">
          <div class="empty-icon">ğŸ“š</div>
          <div class="empty-title">ì•„ì§ ì™„ë£Œí•œ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤</div>
          <div class="empty-text">
            í•™ìŠµì„ ì‹œì‘í•˜ë©´<br/>
            ì™„ë£Œí•œ ë‹¨ì–´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
          </div>
          <a href="index.html" class="btn btn-primary">í•™ìŠµ ì‹œì‘í•˜ê¸°</a>
        </div>
      `;
    }

    init();
  </script>
</body>
</html>
